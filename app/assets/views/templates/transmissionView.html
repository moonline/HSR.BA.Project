<div class="main transmitView area page" data-layout="border">
	<div data-region="middle">
		<div data-region="center">
			<div class="operationState">
				<span class="messagebox error" data-ng-if="operationState === ApplicationState.failed">Loading of data failed. Maybe server is not available.</span>
				<span class="messagebox pending" data-ng-if="operationState === ApplicationState.pending">Loading ...</span>
				<span class="messagebox saving" data-ng-if="operationState === ApplicationState.saving">Saving ...</span>
			</div>
			<form class="wizard">
				<div class="wizardStep area pane" data-step="DataSelection"
					 data-ng-if="currentWizardStep == ExportWizardSteps.ToolSelection">
					<div class="requestTemplateState" data-ng-if="targetPPT">
						<span class="messagebox error" data-ng-if="!currentRequestTemplate">No request template found assigned with this project planning tool. Please create one.</span>
					</div>

					<h2>Target selection</h2>

					<div class="formLine">
						<label>Target system</label>
						<select title="Choose the target project planning tool to transmit tasks" data-ng-model="targetPPTAccount" data-ng-options="pptAccount.pptUrl for pptAccount in pptAccounts"
							data-ng-change="setTarget(targetPPTAccount)"></select>
					</div>
					<div class="formLine">
						<label>Request template to transmit</label>
						<select title="Choose the request template to rendering transmitting requests" data-ng-disabled="!targetPPTAccount" data-ng-model="currentRequestTemplate"
							data-ng-options="pptAccountRequestTemplate.url for pptAccountRequestTemplate in pptAccountRequestTemplates"
							data-ng-change="setRequestTemplate(currentRequestTemplate)"></select>
					</div>
					<div class="formLine">
						<label>Project in project planning tool</label>
						<input title="Project value has to match with the field of the project in the project planning tool you mapped in the request template." type="text" data-ng-model="pptProject" data-ng-change="setPPTProject(pptProject)" />
					</div>

					<button data-ng-disabled="pptProject.length < 1 || !targetPPTAccount || !currentRequestTemplate || !currentRequestTemplate"
							class="action update" data-ng-click="nextStep()" title="Forward to next step">
						<span class="icon">&#x21e8;</span> Select decisions
					</button>

					<div class="exportProgressBar">
						<span class="currentStep">Select Input Data</span><span class="arrows">&#x21e8;</span>
						<span class="futureStep">Select Tasks to Export</span><span class="arrows">&#x21e8;</span>
						<span class="futureStep">Perform Export</span>
					</div>
				</div>

				<div class="wizardStep area pane" data-step="DataSelection" data-ng-if="currentWizardStep == ExportWizardSteps.DataSelection">
					<h2>Decision &amp; Option selection</h2>
					<ul data-type="list" class="problems">
						<li data-ng-repeat="(pkey, decisionGroup) in decisionMappings" class="problemElement">
							<span class="problem">{{decisionGroup.problem.name}}
								<span class="typeDeclaration" title="Problem Template from DSK">&lt;PT&gt;</span> [#{{decisionGroup.problem.id}}]
							</span>
							<ul class="decisions">
								<li data-ng-repeat="(dkey,decisionElement) in decisionGroup.decisions">
									{{decisionElement.decision.name}}
									<span class="typeDeclaration" title="Problem Occurence from DSK">&lt;PO&gt;</span> [#{{decisionElement.decision.id}}]
									<dl>
										<dt>Mapped task templates to transmit</dt>
										<dd>
											<ul class="taskTemplates">
												<li>
													<input title="Transmit subtasks (tasks of options) as normal tasks (no root element)" type="radio"
														   data-ng-model="decisionElement.rootElementForSubNodes" data-ng-value="null">
													No root element for subtasks</li>
												<li data-ng-repeat="(mkey, decisionMapping) in decisionElement.mappings">
													<input title="Use as root element for subtasks (tasks of options)" type="radio" data-ng-model="decisionElement.rootElementForSubNodes" data-ng-value="decisionMapping" data-ng-disabled="!decisionElement.taskTemplatesToExport[mkey]">
													<input title="Transmit this task" type="checkbox" data-ng-model="decisionElement.taskTemplatesToExport[mkey]" />&nbsp;
													{{decisionMapping.taskTemplate.name}}
													<span class="typeDeclaration" title="Task Template from EEPPI">&lt;TT&gt;</span>&nbsp;
													[#{{decisionMapping.taskTemplate.id}}]
												</li>
											</ul>
										</dd>
										<dt>Alternatives
											<!--<button data-ng-click="toggleVisibilityState(dkey)" class="action">
												<span data-ng-if="!decisionChildrenVisibilityState[dkey]" class="symbol extremeSmall">&#x25b2;</span>
												<span data-ng-if="decisionChildrenVisibilityState[dkey]" class="symbol extremeSmall">&#x25bc;</span>
											</button>-->
										</dt>
										<dd>
											<ul class="alternatives">
												<li data-ng-repeat="(akey, alternativeElement) in decisionElement.alternatives">
													{{alternativeElement.alternative.name}}
													<span class="typeDeclaration" title="Option Occurence from DSK">&lt;OO&gt;</span>&nbsp;
													[#{{alternativeElement.alternative.id}}]
													<dl>
														<dt>Mapped task templates to transmit</dt>
														<dd>
															<ul class="taskTemplates">
																<li data-ng-repeat="(amkey, alternativeMapping) in alternativeElement.mappings">
																	<input type="checkbox" data-ng-model="decisionElement.taskTemplatesToExport[amkey]" />&nbsp;
																	{{alternativeMapping.taskTemplate.name}}
																	<span class="typeDeclaration" title="Task Template from EEPPI">&lt;TT&gt;</span>&nbsp;
																	[#{{alternativeMapping.taskTemplate.id}}]
																</li>
															</ul>
														</dd>
													</dl>
												</li>
											</ul>
										</dd>
									</dl>
								</li>
							</ul>
						</li>
					</ul>

					<button class="action update" data-ng-click="nextStep(); processTaskTemplates();"
						title="Render requests for selected Task templates">
						<span class="icon">&#x21e8;</span>Transform selected decisions
					</button>

					<div class="exportProgressBar">
						<span class="passedStep">Select Input Data</span><span class="arrows">&#x21e8;</span>
						<span class="currentStep">Select Tasks to Export</span><span class="arrows">&#x21e8;</span>
						<span class="futureStep">Perform Export</span>
					</div>
				</div>

				<div class="wizardStep area pane	" data-step="Transformation" data-ng-if="currentWizardStep == ExportWizardSteps.Transformation">
					<h2>Transformation</h2>
					<ul class="requests">
						<!-- openRequestDetail -->
						<li data-ng-repeat="exportRequest in exportRequests">
							<dl>
								<dt class="request">{{exportRequest.taskTemplate.name}} ({{exportRequest.node.name}})
									<button data-ng-click="toggleRequestDetails($index+'RQ')" class="action">
										<span data-ng-if="openRequestDetail != $index+'RQ'" class="symbol extremeSmall">&#x25bc; Show request</span>
										<span data-ng-if="openRequestDetail == $index+'RQ'" class="symbol extremeSmall">&#x25b2; Hide request</span>
									</button>
									<button data-ng-if="exportRequest.exportState" data-ng-click="toggleRequestDetails($index+'RS')" class="action">
										<span data-ng-if="openRequestDetail != $index+'RS'" class="symbol extremeSmall">&#x25bc; Show response</span>
										<span data-ng-if="openRequestDetail == $index+'RS'" class="symbol extremeSmall">&#x25b2; Hide response</span>
									</button>
								</dt>
								<dd data-ng-if="openRequestDetail == $index+'RQ'"><pre>{{exportRequest.requestBody}}</pre></dd>
								<dt data-ng-if="exportRequest.exportState" class="response">
									<span class="error" data-ng-if="exportRequest.exportState === ApplicationState.failed">Transmit failed.</span>
									<span class="pending" data-ng-if="exportRequest.exportState === ApplicationState.pending">Transmitting ...</span>
									<span class="success" data-ng-if="exportRequest.exportState === ApplicationState.successful">Transmit successful</span>
								</dt>
								<dd data-ng-if="exportRequest.exportState && openRequestDetail == $index+'RS'">
									<span data-ng-if="exportRequest.exportState === ApplicationState.failed">
										Transmit failed. Maybe there is an JSON syntax error. Please check your syntax:
										<a href="http://json.parser.online.fr/">http://json.parser.online.fr/</a>
									</span>
									<pre>{{exportRequest.requestPrint}}</pre>
								</dd>
							</dl>
							<ul class="subRequests">
								<li data-ng-repeat="subRequest in exportRequest.subRequests">
									<dl class="">
										<dt class="request">{{exportRequest.taskTemplate.name}} &gt; {{subRequest.taskTemplate.name}} ({{subRequest.node.name}})
											<button data-ng-click="toggleRequestDetails($index+'SRQ')" class="action">
												<span data-ng-if="openRequestDetail != $index+'SRQ'" class="symbol extremeSmall">&#x25bc; Show request</span>
												<span data-ng-if="openRequestDetail == $index+'SRQ'" class="symbol extremeSmall">&#x25b2; Hide request</span>
											</button>
											<button data-ng-if="subRequest.exportState" data-ng-click="toggleRequestDetails($index+'SRS')" class="action">
												<span data-ng-if="openRequestDetail != $index+'SRS'" class="symbol extremeSmall">&#x25bc; Show response</span>
												<span data-ng-if="openRequestDetail == $index+'SRS'" class="symbol extremeSmall">&#x25b2; Hide response</span>
											</button>
										</dt>
										<dd data-ng-if="openRequestDetail == $index+'SRQ'"><pre>{{subRequest.requestBody}}</pre></dd>
										<dt class="response">
											<span class="error" data-ng-if="subRequest.exportState === ApplicationState.failed">Transmit failed.</span>
											<span class="pending" data-ng-if="subRequest.exportState === ApplicationState.pending">Transmitting ...</span>
											<span class="success" data-ng-if="subRequest.exportState === ApplicationState.successful">Transmit successful</span>
										</dt>
										<dd data-ng-if="openRequestDetail == $index+'SRS'">
											<span data-ng-if="subRequest.exportState === ApplicationState.failed">
												Transmit failed. Maybe there is an JSON syntax error. Please check your syntax:
												<a href="http://json.parser.online.fr/">http://json.parser.online.fr/</a>
											</span>
											<pre>{{subRequest.requestPrint}}</pre>
										</dd>
									</dl>
								</li>
							</ul>
						</li>
					</ul>

					<button class="action update" data-ng-click="transmit()"><span class="icon" data-icon="transmit"></span> Transmit to PPT ({{targetPPTAccount.pptUrl}})</button>

					<div class="exportProgressBar">
						<span class="passedStep">Select Input Data</span><span class="arrows">&#x21e8;</span>
						<span class="passedStep">Select Tasks to Export</span><span class="arrows">&#x21e8;</span>
						<span class="currentStep">Perform Export</span>
					</div>
				</div>
			</form>
		</div>
	</div>
</div>